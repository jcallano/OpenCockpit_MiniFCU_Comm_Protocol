MiniFCU / MiniEFIS Serial Protocol
Reverse Engineering Notes by @jcallano
Version: 1.1 (reverse engineering to share with community)
Last updated: 2026-Jan-01
Target aircraft - hardware - software : Minicockpit minifcus+cap efis Airbus A320-fenix A320 -MSFS2020

DISCLAIMER

This document is the result of reverse engineering work using man in the middle atack technic.
It is NOT official documentation and is not affiliated with any hardware manufacturer or aircraft add-on developer.
May have errors.
Use at your own risk.

============================================================

PHYSICAL LAYER & CONNECTION
============================================================

Interface:
- USB Serial (CH340 USB-to-Serial chipset)

Serial Parameters:
- Baud Rate: 9600 bps
- Data Bits: 8
- Parity: None
- Stop Bits: 1
- Flow Control: None (no RTS/CTS, no XON/XOFF)

Critical Power Requirement:
- DTR and RTS lines MUST be asserted HIGH (True)
- If DTR/RTS are not set, the microcontroller does not power up

Notes:
- Only one application can open the COM port at a time (typical Windows limitation)
- Confirmed working with pySerial and vendor software
- The panel behaves like a “dumb” USB-serial device: all logic is PC-side

============================================================
2. PROTOCOL OVERVIEW

Protocol characteristics:
- ASCII-based
- Token-oriented
- Event-driven
- The panel is effectively stateless (no flight logic, no mode authority)

Core philosophy:
- Hardware reports physical actions (buttons/encoders) and sometimes absolute knob values
- Hardware does NOT:
- Calculate aircraft values
- Maintain managed/selected logic
- Decide LED states
- Maintain synchronization on its own
- PC software must:
- Maintain full FCU/EFIS state
- Decide which LEDs/segments are ON/OFF
- Refresh displays (continuous or on change)
- Repaint the panel after reconnect/power-up

============================================================
3. MESSAGE FRAMING, DIRECTION, AND DELIMITERS

PC -> Hardware (Output):
- Each token MUST end with a comma ","
- Example:
A32000,

Hardware -> PC (Input):
- Each event frame MUST end with a semicolon ";"
- Example:
17;

Important:
- Bursts may contain multiple tokens/events
- Always parse by delimiter ("," for TX tokens, ";" for RX frames)
- Do NOT assume fixed-length messages
- A single RX frame can contain comma-separated fields, e.g.:
CODE,VALUE;
or other multi-field forms depending on firmware behavior

============================================================
4. STARTUP SEQUENCE (MANDATORY FOR RELIABLE BEHAVIOR)

After opening the serial port and asserting DTR/RTS, execute:

4.1 Handshake Command
Command:
C,
Purpose:
- Wakes up firmware
- Some units respond with firmware IDs (e.g. 901; 956; 959;)
- Some units may emit a build/date stamp-like number (example observed: 20251113;)
- Some units may respond with nothing
IMPORTANT:
- A response is NOT guaranteed
- Software MUST NOT abort if no response is received

4.2 Initialization Burst (limits & scaling)
The following tokens MUST be sent after C, (order matters):

  Q400,
  K100,
  -99,
  +10,
  n49000,
  b100,
  [6000,
  ]-6000,
  Z9900,
  X-9900,
  I,
  Y,
  W,
  O,
  {1,
  (3248,
  }2200,
  =1100,
  $745,
  %0,

Notes:
  - Without this burst, encoders/displays may behave incorrectly
  - These tokens define internal limits and scaling used by the panel/firmware


4.3 Power-Up State Synchronization (repaint)
After initialization, PC should repaint the entire panel:
- Set BARO/QNH display mode and value
- Initialize LEDs
- Initialize LCD segments
- Set backlight brightness

Observed repaint patterns include (examples only; your software may differ):
  - QNH display update: #xxxx,
  - Backlight: Bxxxx,
  - LED set/clear tokens (upper/lowercase or numeric pairs)
  - Segment tokens (i, d, o, h, w, v, x, s, q, Y, etc.)

Robustness note:
  - Re-sending parts of the repaint burst increases resilience after reconnect

============================================================
5. ENCODERS (5 TOTAL) AND EVENT VARIANTS

The MiniFCU has five physical rotary encoders:
- BARO (altimetric setting)
- SPEED
- HEADING
- ALTITUDE
- VERTICAL SPEED / FLIGHT PATH ANGLE (dual behavior)

Encoder event variants (important for parser design):
A) Absolute reporting:
- CODE,VALUE;
- VALUE is an absolute knob/display value as understood by the PC-side logic.
- Common for many rotations once a value is initialized.

B) Step-only reporting (no value field):
   - CODE;
   - Observed when the knob is rotated before a value has been initialized/displayed
   - PC should interpret this as a relative step or trigger a repaint to initialize the display value.

C) Absolute with prefix (BARO inHg):
   - CODE,_####;
   - Underscore prefix has been observed for inHg mode values (inHg * 100).


Implementation guidance:
- Parse RX by ';' frames.
- For each frame:
- Split by ',' into fields.
- If there is 1 field: treat as a step/button event.
- If there are 2 fields: treat as code + value (value may start with '_' and/or '-' sign).
- Keep the parser tolerant: firmware revisions can shift which code is used for the same physical action.

============================================================
6. HARDWARE -> PC INPUT EVENTS (KNOWN)

6.1 FCU Encoders (baseline mapping)
Speed:
- CW : 13;
- CCW : 14;
- Push: 11;
- Pull: 12;

Heading:
  - CW  : 3;
  - CCW : 4;
  - Push: 1;
  - Pull: 2;

Altitude:
  - CW  : 17;
  - CCW : 18;
  - Push: 15;
  - Pull: 16;

Vertical Speed / FPA:
  - CW  : 21;
  - CCW : 22;
  - Push: 19;
  - Pull: 20;

Note:
  - In real logs, rotations may appear as CODE,VALUE; (absolute), not only CODE;.


6.2 Altitude Increment Buttons
- 59; -> ALT increment = 100 ft
- 60; -> ALT increment = 1000 ft
Notes:
- These do NOT control LEDs directly.
- They inform the PC how to interpret ALT encoder step size.

6.3 Push Buttons (FCU)
- AP1 : 50;
- AP2 : 51;
- A/THR : 52;
- LOC : 53;
- EXPED : 54; (variant seen in some setups: 554;)
- APPR : 55;

Additional FCU buttons (observed / mapped):
- SPD/MACH            : 56;
- HDG/TRK and VS/FPA  : 57;
- METRIC              : 58;


6.4 EFIS Push Buttons
- FD : 62;
- LS : 63;
- CSTR : 64;
- WPT : 65;
- VOR.D : 66;
- NDB : 67;
- ARPT : 68;

6.5 EFIS Selectors (ND MODE / ND RANGE)
ND MODE selector positions:
- 71; 72; 73; 74; 75; 76;

ND RANGE selector positions:
  - 80; 81; 82; 83; 84; 85;


6.6 RADIO selectors (observed)
Radio selector 1:
- 77; 78; 79;

Radio selector 2:
  - 86; 87; 88;

Notes:
  - Additional related numeric codes may appear during these interactions (firmware/software dependent).


6.7 BARO / QNH Encoder and Units (IMPORTANT)
Absolute BARO value events (hPa-like values around 1000):
- 101,VALUE;
- 102,VALUE;
Notes:
- VALUE is the absolute BARO number (typically hPa)
- Accept both 101 and 102 as valid BARO sources.

BARO units + inHg absolute values:
  - When BARO is in inHg mode, absolute reporting may appear as:
      103,_####;
      104,_####;
    Where #### represents inHg * 100 (e.g., 29.77 inHg -> _2977).

Uninitialized BARO behavior (step-only):
  - If BARO value has not been initialized on the panel display, rotating the BARO knob can emit:
      103;
      104;
  Meaning:
    - Encoder rotation detected, but no absolute value yet.
  PC-side recommended behavior:
    - Treat as a relative step OR immediately repaint by pushing the current simulator BARO value to the panel,
      which initializes the display and enables absolute reporting.

BARO knob push/pull (observed mapping):
  - Push: 70;
  - Pull: 69;

Practical note:
  - The exact CW/CCW association between 103 vs 104 should be verified per unit/firmware.


6.8 Buttons are momentary
- Events represent physical press only.
- PC decides how to interpret them (toggle, hold, managed vs selected logic, etc.).

============================================================
7. PC -> HARDWARE OUTPUT COMMANDS (KNOWN)

7.1 Displays
Speed:
- Sxxx,
Heading:
- Hxxx,
Altitude:
- Axxxxx,
Vertical Speed / FPA display:
- F####, (observed used by vendor software; includes sign, e.g., F-700, F1000, F0,)
QNH / BARO display:
- #xxxx,

7.2 Managed / Selected Indicators & LCD Segments (observed)
Examples of segment tokens:
- z, / x, -> Speed managed dot ON / OFF (observed)
- m, / s, -> Heading managed dot ON / OFF (observed)
- a, / b, -> Altitude managed dot ON / OFF (observed)
- d, -> Speed dashes "---" (observed)
- h, -> Heading dashes "---" (observed)
- D, -> Altitude / VS dashes "---" (observed)
- Other observed tokens: i, o, w, v, x, s, q, Y
Notes:
- Exact semantics may vary across firmware revisions.
- Treat these as “panel segments/annunciators” controlled entirely by PC.

7.3 LEDs
General rule (observed):
- Uppercase = LED ON
- Lowercase = LED OFF

Autopilot / FCU LEDs:
  - P / p  -> AP1
  - U / u  -> AP2
  - T / t  -> A/THR
  - L / l  -> LOC
  - E / e  -> EXPED
  - R / r  -> APPR

EFIS LEDs (numeric pairs, observed mapping):
  - 51 / 50  -> FD
  - 41 / 40  -> LS
  - 31 / 30  -> CSTR
  - 21 / 20  -> WPT
  - 11 / 10  -> VOR.D
  - 01 / 00  -> NDB
  - !1 / !0  -> ARPT


7.4 Backlight
Command:
- Bxxxx,
Example:
- B1000, (maximum brightness)

7.5 BARO LCD mode forcing (IMPORTANT)
Force showing the BARO/QNH numeric value on the QNH LCD:
- {1,
- @1,

Force showing STD on the QNH LCD:
  - {0,
  - @2,

Notes:
  - These tokens appear to control what the BARO LCD is presenting (value vs STD).
  - The PC should drive these modes based on simulator state and user actions.

============================================================
8. PC-SIDE “RESYNC / REFRESH” COMMANDS (OBSERVED)

Some Windows software repeatedly sends tokens such as:
- C,
- 6,
- (sometimes) 9,

Interpretation:
- These appear to be application-level refresh/resynchronization triggers used by the PC software to keep the
panel congruent with simulator state and its own internal model.
- These are NOT required by the hardware to keep the serial channel open, so they should not be described as
“heartbeats” at the transport level.

Follow-on status-like bursts:
- After some of these refresh tokens, the panel may emit numeric bursts such as:
94; 95; 98; 99;
952; 953; 954; 955;
960; 962; 963;
970; 972;
980; 982;
plus handshake/ID events like:
901; 956; 959;
- These appear to be firmware/status-like outputs rather than user inputs.
- Parse them (do not crash), but treat them as non-user events unless proven otherwise.

============================================================
9. IMPLEMENTATION NOTES (PARSER AND ROBUSTNESS)

Parsing rules (recommended):
- RX:
- Accumulate bytes into a buffer
- Split frames by ';'
- For each frame:
- Trim whitespace
- Split by ','
- If one field: event code only
- If two fields: code + value (value may be negative and/or start with '_')
- Never assume fixed length
- TX:
- Ensure every token ends with ','

Repaint strategy:
- On connect and on any suspected desync, repaint the panel:
- All displays (SPD/HDG/ALT/VS/FPA and BARO/QNH)
- All LEDs
- Required segments/managed dots
- Backlight
- BARO LCD mode (value vs STD)

Firmware variation:
- Expect small differences in numeric codes and which codes carry values.
- Keep the parser tolerant and maintain an “unknown code logger” for future mapping.

============================================================
10. OPEN ITEMS / UNKNOWNs (TO BE EXTENDED NEXT SESSION)

QNH / QFE LEDs:
- There are QNH and QFE indicator LEDs on the BARO panel area.
- The output command(s) that control these LEDs have not been identified yet.
- Recommended discovery method:
- Capture PC->HW traffic while toggling QNH vs QFE in the vendor software
- Diff the repaint bursts to find the unique token(s) controlling those LEDs

Additional status-like numeric bursts:
- The meaning of 94/95/98/99 and 95x/96x/97x/98x families is still unknown.
- They appear during PC-driven refresh sequences (C, / 6, / 9,).

============================================================
END OF DOCUMENT
