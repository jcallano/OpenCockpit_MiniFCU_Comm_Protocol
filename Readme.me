================================================================================
                MINIFCU INTERFACE PROTOCOL SPECIFICATION v2.0
                Expanded via Reverse Engineering & Serial Dumps
================================================================================

1. PHYSICAL LAYER & CONNECTION
--------------------------------------------------------------------------------
INTERFACE:   USB Serial (CH340 chipset)
BAUD RATE:   9600 bps
DATA BITS:   8
PARITY:      None
STOP BITS:   1
FLOW CTRL:   None (Software Handshaking)

CRITICAL:    DTR (Data Terminal Ready) and RTS (Request to Send) lines MUST be 
             set to TRUE (High) to power/wake the microcontroller.

2. PROTOCOL SYNTAX
--------------------------------------------------------------------------------
FORMAT:      ASCII Text
PC -> HW:    Commands are comma-delimited (e.g., "C,", "51,").
             Multiple commands can be chained in a single packet.
             Example: "i,d,o,h,51," (seen in active dumps).
HW -> PC:    Responses are semicolon-delimited (e.g., "62;", "101,1020;").

3. INITIALIZATION SEQUENCE (HANDSHAKE)
--------------------------------------------------------------------------------
Based on analysis of 'dump.txt', the following exact sequence is required to
unlock the panel. Timing is derived from packet timestamps.

STEP  DIRECTION   DATA (ASCII)                  DESCRIPTION
----  ---------   ----------------------------  --------------------------------
1     PC -> HW    C,                            Wake-up / Handshake Call.
      HW -> PC    901;956;959;                  (Observed Response) Status flags.

2     PC -> HW    9,C,c,                        Command Mode Configuration.
3     PC -> HW    7,%0,i,y,w,o,N,               Low Level I/O Enable.

4     PC -> HW    Q400,K100,-99,+10,n49000,     "Magic String" Part 1.
                  b100,[6000,]-6000,Z9900,      Sensor calibration & limits.
                  X-9900,I,Y,W,O,{1,(3248,      
                  }2200,=1100,$745,%0,

5     PC -> HW    w,v,x,s,q,I,S100,w,v,p,u,     "EFIS Unlock" Sequence.
                  t,l,e,r,B1000,{0,@2,50,40,    Unlocks buttons and sets 
                  30,20,10,00,!1,Y,             initial LED states.

4. KEEP-ALIVE (POLLING)
--------------------------------------------------------------------------------
To prevent the hardware watchdog from resetting, the PC must poll the device.
In 'dumpidle.txt', this occurs cyclically.

COMMAND:     6,
FREQUENCY:   Approx. every 500ms - 1000ms.
RESPONSE:    99;95;951;962;972;982; (Observed in dumpidle.txt)
             
             Analysis of Response "99;95;...":
             Likely represents the current state of potentiometers or internal
             counters. Values remain static when hardware is idle.

5. INPUT CODES (HARDWARE -> PC)
--------------------------------------------------------------------------------
When a user interacts with the panel, the HW sends a short code ending in ';'.

KNOB / ENCODERS:
----------------
SPD INC:     13;       SPD DEC:     14;
HDG INC:     3;        HDG DEC:     4;
ALT INC:     17;       ALT DEC:     18;
VS INC:      21;       VS DEC:      22;
BARO ROT:    101,val;  (Absolute value return)

PUSH/PULL ACTIONS:
------------------
SPD PUSH:    11;       SPD PULL:    12;
HDG PUSH:    1;        HDG PULL:    2;
ALT PUSH:    15;       ALT PULL:    16;
VS PUSH:     19;       (Level Off)

BUTTONS (MOMENTARY):
--------------------
LOC:         53;       FD:          62;
AP1:         50;       LS:          63;
AP2:         51;       CSTR:        64;
ATHR:        52;       WPT:         65;
EXPED:       54;       VORD:        66;
APPR:        55;       NDB:         67;
                       ARPT:        68;

6. OUTPUT CODES (PC -> HARDWARE)
--------------------------------------------------------------------------------
PC sends these commands to update displays and LEDs. They are often chained.

LEDS (TOGGLE LOGIC):
--------------------
FUNCTION     ON CODE   OFF CODE    NOTE
--------     -------   --------    ----
AP1          P,        p,
AP2          U,        u,
ATHR         T,        t,
LOC          L,        l,
EXPED        E,        e,
APPR         R,        r,

EFIS LEDS:
----------
FD           51,       50,
LS           41,       40,
CSTR         31,       30,
WPT          21,       20,
VORD         11,       10,
NDB          01,       00,
ARPT         !1,       !0,

DISPLAYS (7-SEGMENT):
---------------------
SPEED:       Sxxx,     (e.g., S250,)
HEADING:     Hxxx,     (e.g., H180,)
ALTITUDE:    Axxxxx,   (e.g., A35000,)
VERT SPD:    Vxxxx,    (e.g., V-1500,)
QNH:         #xxxx,    (e.g., #1013,)

MANAGED DOTS & DASHES:
----------------------
SPD DOT:     z, (ON)   x, (OFF)    SPD DASHES:  d,
HDG DOT:     m, (ON)   s, (OFF)    HDG DASHES:  h,
ALT DOT:     a, (ON)   b, (OFF)

7. OBSERVATIONS FROM DUMP ANALYSIS
--------------------------------------------------------------------------------
1. COMMAND CHAINING:
   In 'dump.txt' [Source: 10], pressing the FD button (HW sends "62;")
   results in the PC sending: "i,d,o,h,51,"
   
   Breakdown:
   - i, : State refresh (undocumented, likely "Input Enable" or "Idle").
   - d, : Set Speed window to Dashes (Managed mode).
   - o, : State refresh (undocumented).
   - h, : Set Heading window to Dashes (Managed mode).
   - 51,: Turn on FD LED.

2. UNKNOWN COMMANDS 'i' AND 'o':
   These appear frequently in the active dump mixed with display commands.
   They are likely "No-Op" or "Keep Synchronized" flags used by the 
   original driver software to ensure the hardware buffer does not stall.

3. RESPONSE LATENCY:
   The hardware response is immediate. In 'dump.txt', the delta between
   HW sending "62;" and PC sending "51," is approx 100-200ms.

================================================================================
